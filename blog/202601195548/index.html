<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1,maximum-scale=1" name=viewport><meta content="uncomfy uh... i have a website? Axum with utoipa " name=description><title>Axum with utoipa</title><link href=/favicon.png rel=icon><link href="https://uncomfyhalomacro.pl/style.css?h=b3ea0c6ca2d4276c7a3b" rel=stylesheet><link media="(prefers-color-scheme: dark)" href=/syntax-theme-dark.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=/syntax-theme-light.css rel=stylesheet><link href="https://uncomfyhalomacro.pl/color/auto.css?h=c9e3a532fd9af99660b2" rel=stylesheet><link href=https://uncomfyhalomacro.pl/atom.xml rel=alternate title=RSS type=application/atom+xml><script crossorigin src=https://kit.fontawesome.com/51d55b4c7d.js></script><script>function resize() {
    var x = document.getElementById("myLinks");
    // var y = document.getElementsByClassName("subcontainer")[0];
    // var nav = document.getElementsByClassName("topnav")[0];
    if (x.style.display === "block") {
      x.style.display = "none";
    } else {
      x.style.display = "block";
    }
  }
  try {
    const bannedReferrers = [/news\.ycombinator\.com/i, /reddit\.com/i];
    if (document.referrer) {
      const ref = new URL(document.referrer);
      if (
        !/bad-networks/i.test(window.location.href) &&
        bannedReferrers.some((r) => r.test(ref.host))
      ) {
        window.location.href = "https://www.pcloadletter.dev/blog/bad-networks";
      }
    }
  } catch (e) {console.log(e)}</script><body><div class=main-grid><div class=topnav><a class=icon href=javascript:void(0); onclick=resize()> <img alt="favicon here" class=icon_img src=/favicon.png> </a><a class=active href=https://uncomfyhalomacro.pl/>home</a><a href=https://uncomfyhalomacro.pl/tags>tags</a><a href=https://uncomfyhalomacro.pl/blog/>blog</a><a href=/microbio-cv.pdf>microbio cv</a><a href=/tech-cv.pdf>tech cv</a><a href=/public.txt>gpg keys</a><div id=myLinks><a href=https://uncomfyhalomacro.pl/lecture/>lecture</a><a href=https://uncomfyhalomacro.pl/poetry/>poetry</a><a href=https://uncomfyhalomacro.pl/scripts/>scripts</a></div></div><div class=sub-grid><div class=content-grid><div class=info><h1>Axum with utoipa<span> <a href=https://uncomfyhalomacro.pl/atom.xml><i class="fa-sharp fa-solid fa-rss"></i></a> </span></h1><p><span class=author> Soc Virnyl Estela </span>| <span class=dates>2026-01-21</span> | <span class=readtime>reading time: ~5min</span></div><div class=toc><h1>Contents</h1><div class=toc-container><ul><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#preparing-your-project>Preparing your project</a><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#what-this-project-does>What this project does</a> <ul><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#creating-our-types>Creating our types</a><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#building-our-api-endpoints>Building our API endpoints</a></ul><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#testing-our-api>Testing our API</a><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#but-there-is-a-problem>But there is a problem</a> <ul><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#how-to-handle-large-numbers>How to handle large numbers</a></ul><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#conclusion>Conclusion</a></ul></div></div><div class=content-body><article><section class=content><p>I have been looking for existing solutions for a Rust equivalent of FastAPI — building APIs with the type safety and the convenience of auto-generated API docs with OpenAPI.<p>And after searching all over the internet, I have found <a href=https://github.com/juhaku/utoipa rel=external>utoipa</a>. Currently, I am most familiar with the <a href=https://github.com/tokio-rs/axum rel=external>Axum</a> web framework when building APIs in Rust.<p>So in this blog post, I'll show you how to create a simple API with <a href=https://github.com/tokio-rs/axum rel=external>axum</a> and <a href=https://github.com/juhaku/utoipa rel=external>utoipa</a>.<h2 id=preparing-your-project>Preparing your project<a aria-label="Anchor link for: preparing-your-project" class=zola-anchor href=#preparing-your-project>§</a></h2><p>Run the following commands to initialise a new Rust project<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=shellscript><span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>cargo</span><span style=color:light-dark(#79740e,#b8bb26)> new</span><span style=color:light-dark(#79740e,#b8bb26)> axum-api</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>cd</span><span style=color:light-dark(#79740e,#b8bb26)> axum-api</span></span></code></pre><p>Let's add the dependencies<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=shellscript><span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>cargo</span><span style=color:light-dark(#79740e,#b8bb26)> add</span><span style=color:light-dark(#79740e,#b8bb26)> tokio</span><span style=color:light-dark(#8f3f71,#d3869b)> -</span><span style=color:light-dark(#8f3f71,#d3869b)>F</span><span style=color:light-dark(#79740e,#b8bb26)> full</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>cargo</span><span style=color:light-dark(#79740e,#b8bb26)> add</span><span style=color:light-dark(#79740e,#b8bb26)> serde</span><span style=color:light-dark(#8f3f71,#d3869b)> -</span><span style=color:light-dark(#8f3f71,#d3869b)>F</span><span style=color:light-dark(#79740e,#b8bb26)> derive</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>cargo</span><span style=color:light-dark(#79740e,#b8bb26)> add</span><span style=color:light-dark(#79740e,#b8bb26)> serde_json</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>cargo</span><span style=color:light-dark(#79740e,#b8bb26)> add</span><span style=color:light-dark(#79740e,#b8bb26)> axum</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>cargo</span><span style=color:light-dark(#79740e,#b8bb26)> add</span><span style=color:light-dark(#79740e,#b8bb26)> utoipa-swagger-ui</span><span style=color:light-dark(#8f3f71,#d3869b)> -</span><span style=color:light-dark(#8f3f71,#d3869b)>F</span><span style=color:light-dark(#79740e,#b8bb26)> axum</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>cargo</span><span style=color:light-dark(#79740e,#b8bb26)> add</span><span style=color:light-dark(#79740e,#b8bb26)> utoipa-axum</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>cargo</span><span style=color:light-dark(#79740e,#b8bb26)> add</span><span style=color:light-dark(#79740e,#b8bb26)> utoipa</span></span></code></pre><h2 id=what-this-project-does>What this project does<a aria-label="Anchor link for: what-this-project-does" class=zola-anchor href=#what-this-project-does>§</a></h2><p>This project will just do simple CRUD operations and have the following endpoints<ul><li>POST /items/create<li>GET /items/{id}<li>DELETE /items/{id}</ul><p>We can have an SQLite database or some kind of storage we can use to simulate CRUD. But I'll just be lazy and use a <a href=https://github.com/xacrimon/dashmap rel=external>dashmap</a>. Hence, adding a new dependency.<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=shellscript><span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>cargo</span><span style=color:light-dark(#79740e,#b8bb26)> add</span><span style=color:light-dark(#79740e,#b8bb26)> dashmap</span><span style=color:light-dark(#8f3f71,#d3869b)> -</span><span style=color:light-dark(#8f3f71,#d3869b)>F</span><span style=color:light-dark(#79740e,#b8bb26)> serde</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>cargo</span><span style=color:light-dark(#79740e,#b8bb26)> add</span><span style=color:light-dark(#79740e,#b8bb26)> rand</span><span style=color:light-dark(#928374,#928374);font-style:italic>  #</span><span style=color:light-dark(#928374,#928374);font-style:italic> To generate random ids</span></span></code></pre><h3 id=creating-our-types>Creating our types<a aria-label="Anchor link for: creating-our-types" class=zola-anchor href=#creating-our-types>§</a></h3><p>Let's create our types. Here, we have <code>Item</code> and <code>ItemBucket</code><pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=rust><span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> dashmap</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>DashMap</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> serde</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Deserialize</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> serde</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Serialize</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>derive</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>Debug</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Serialize</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Deserialize</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>ToSchema</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Clone</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>struct</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>    pub</span><span style=color:light-dark(#076678,#83a598)> size</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> usize</span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>    pub</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> String</span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>type</span><span style=color:light-dark(#b57614,#fabd2f)> ItemBucket</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>DashMap</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span></code></pre><p>The <code>ItemBucket</code> uses <code>Arc</code> or <strong>atomic reference counted</strong> to allow sharing ownership of the data. The data is of type <code>DashMap&lt;u64, Item>></code> which is just a wrapper for <code>HashMap&lt;u64&lt;Item>></code> as <code>Dashmap&lt;T></code> is a direct replacement of <code>RwLock&lt;HashMap&lt;T>></code>. Thus, we can set a new type for shared "app state" or API state to "store" data.<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=rust><span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>derive</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>Default</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>struct</span><span style=color:light-dark(#b57614,#fabd2f)> AppState</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#076678,#83a598)>    bucket</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> ItemBucket</span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span></code></pre><h3 id=building-our-api-endpoints>Building our API endpoints<a aria-label="Anchor link for: building-our-api-endpoints" class=zola-anchor href=#building-our-api-endpoints>§</a></h3><p>Here are the following methods for our POST, GET, and DELETE endpoints<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=rust><span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>post</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span>path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)> "</span><span style=color:light-dark(#79740e,#b8bb26)>/create</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status </span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)> OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body </span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> create_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> id</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> u64</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> random</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> generate_random_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#8f3f71,#d3869b)>10</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> size</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>capacity</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)> {</span><span style=color:light-dark(#076678,#83a598)> size</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#7c6f64,#a89984)> }</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#076678,#83a598)>    app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>insert</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>get</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/</span><span style=color:light-dark(#7c6f64,#a89984)>{</span><span style=color:light-dark(#79740e,#b8bb26)>id</span><span style=color:light-dark(#7c6f64,#a89984)>}</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)>OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Option</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Item</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> get_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Path</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>get</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#427b58,#8ec07c)>&</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>map</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)>v</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)> v</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>delete</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/</span><span style=color:light-dark(#7c6f64,#a89984)>{</span><span style=color:light-dark(#79740e,#b8bb26)>id</span><span style=color:light-dark(#7c6f64,#a89984)>}</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)>OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Option</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Item</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> delete_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Path</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>remove</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#427b58,#8ec07c)>&</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>map</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>_</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> v</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)> v</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span></code></pre><p>And here is the core logic of our main function<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=rust><span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Extension</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Json</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Router</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>extract</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Path</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>response</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> rand</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>prelude</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#427b58,#8ec07c)>*</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> std</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>sync</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>openapi</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>OpenApiBuilder</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> utoipa_axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>router</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>OpenApiRouter</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> utoipa_axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>routes</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> dashmap</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>DashMap</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> rand</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>random</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> serde</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Deserialize</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> serde</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Serialize</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> utoipa_swagger_ui</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>SwaggerUi</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#928374,#928374);font-style:italic>/*</span></span>
<span class=giallo-l><span style=color:light-dark(#928374,#928374);font-style:italic>...our other code here</span></span>
<span class=giallo-l><span style=color:light-dark(#928374,#928374);font-style:italic>*/</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>tokio</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>main</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> main</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> app_state</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>new</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>default</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#7c6f64,#a89984)> (</span><span style=color:light-dark(#076678,#83a598)>app</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> api</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> OpenApiRouter</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>new</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>routes</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>routes!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>create_item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>routes</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>routes!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>get_item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>routes</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>routes!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>delete_item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>layer</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>split_for_parts</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> open_api_builder</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> OpenApiBuilder</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>new</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>build</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>nest</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/items</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> api</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> url</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#7c6f64,#a89984)> "</span><span style=color:light-dark(#79740e,#b8bb26)>localhost:3000</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> listener</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> tokio</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>net</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>TcpListener</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>bind</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#427b58,#8ec07c)>&</span><span style=color:light-dark(#076678,#83a598)>url</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#9d0006,#fb4934)>await</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>unwrap</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> swagger_docs</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> SwaggerUi</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>new</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/docs</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>url</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/api-docs/openapi.json</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> open_api_builder</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> app</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> Router</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>new</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>nest</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/items</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> app</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>merge</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>swagger_docs</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>serve</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>listener</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> app</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#9d0006,#fb4934)>await</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>unwrap</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span></code></pre><p>We use the following declaration<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=rust><span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#7c6f64,#a89984)> (</span><span style=color:light-dark(#076678,#83a598)>app</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> api</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> OpenApiRouter</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>new</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>routes</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>routes!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>create_item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>routes</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>routes!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>get_item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>routes</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>routes!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>delete_item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>layer</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>split_for_parts</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span></code></pre><p>to create an axum router called <code>app</code> and OpenAPI information called <code>api</code> which is passed to <code>OpenApiBuilder</code>. We used <code>.nest</code> method on the <code>OpenApiBuilder</code> so our endpoints will start with the route path <code>/items</code>.<p>Honestly, my only issue currently with the <code>SwaggerUi</code> initialisation is the hard-coded <code>/api-docs/openapi.json</code>. It causes some path issues if the variable is merged incorrectly into the router e.g.<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=rust><span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> app</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> Router</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>new</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>nest</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/items</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> app</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>merge</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>swagger_docs</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span></code></pre><p>One would expect that <code>/items/docs</code> is the path to the OpenAPI documentation which is correct, but because of the <code>.url</code> method, you would also expect that it automatically points to <code>/items/api-docs/openapi.json</code>... <em>which does not</em>. Thus, the example gives confusion and only shows up if you edit the path by prepending <code>/items/</code> in the search bar. For now, my only workaround and safer bet is to ensure that <code>/docs</code> should be at the top-level path of the URL so we merge it giving the complete URL to be <code>localhost:3000/docs</code> while also ensuring that our <code>/api-docs</code> are also at the top-level path next to the root <code>/</code>, hence, pointing to the correct <code>openapi.json</code> data.<h2 id=testing-our-api>Testing our API<a aria-label="Anchor link for: testing-our-api" class=zola-anchor href=#testing-our-api>§</a></h2><details><summary>Here is the fullcode of the API (click to toggle dropdown)</summary> <pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=rust><span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Extension</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Json</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Router</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>extract</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Path</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>response</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> rand</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>prelude</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#427b58,#8ec07c)>*</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> std</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>sync</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>openapi</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>OpenApiBuilder</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> utoipa_axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>router</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>OpenApiRouter</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> utoipa_axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>routes</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> dashmap</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>DashMap</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> rand</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>random</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> serde</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Deserialize</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> serde</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Serialize</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>use</span><span style=color:light-dark(#b57614,#fabd2f)> utoipa_swagger_ui</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>SwaggerUi</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>derive</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>Debug</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Serialize</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Deserialize</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>ToSchema</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Clone</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>struct</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>    pub</span><span style=color:light-dark(#076678,#83a598)> size</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> usize</span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>    pub</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> String</span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>type</span><span style=color:light-dark(#b57614,#fabd2f)> ItemBucket</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>DashMap</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>derive</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>Default</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>struct</span><span style=color:light-dark(#b57614,#fabd2f)> AppState</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#076678,#83a598)>    bucket</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> ItemBucket</span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>fn</span><span style=color:light-dark(#b57614,#fabd2f)> generate_random_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>length</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> usize</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#b57614,#fabd2f)> String</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    const</span><span style=color:light-dark(#8f3f71,#d3869b);font-weight:700> CHARSET</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#427b58,#8ec07c)> &</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span style=color:light-dark(#b57614,#fabd2f)>u8</span><span style=color:light-dark(#7c6f64,#a89984)>;</span><span style=color:light-dark(#8f3f71,#d3869b)> 62</span><span style=color:light-dark(#7c6f64,#a89984)>]</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#79740e,#b8bb26)> b</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#af3a03,#fe8019)> mut</span><span style=color:light-dark(#076678,#83a598)> rng</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> rand</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>rng</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>    (</span><span style=color:light-dark(#8f3f71,#d3869b)>0</span><span style=color:light-dark(#427b58,#8ec07c)>..</span><span style=color:light-dark(#076678,#83a598)>length</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>map</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)>_</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>            let</span><span style=color:light-dark(#076678,#83a598)> idx</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> rng</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>random_range</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#8f3f71,#d3869b)>0</span><span style=color:light-dark(#427b58,#8ec07c)>..</span><span style=color:light-dark(#8f3f71,#d3869b);font-weight:700>CHARSET</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>len</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#8f3f71,#d3869b);font-weight:700>            CHARSET</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span style=color:light-dark(#076678,#83a598)>idx</span><span style=color:light-dark(#7c6f64,#a89984)>]</span><span style=color:light-dark(#9d0006,#fb4934)> as</span><span style=color:light-dark(#b57614,#fabd2f)> char</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>        }</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>collect</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>post</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span>path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)> "</span><span style=color:light-dark(#79740e,#b8bb26)>/create</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status </span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)> OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body </span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)> (</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> create_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> id</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> u64</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> random</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> generate_random_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#8f3f71,#d3869b)>10</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> size</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>capacity</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)> {</span><span style=color:light-dark(#076678,#83a598)> size</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#7c6f64,#a89984)> }</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#076678,#83a598)>    app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>insert</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>get</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/</span><span style=color:light-dark(#7c6f64,#a89984)>{</span><span style=color:light-dark(#79740e,#b8bb26)>id</span><span style=color:light-dark(#7c6f64,#a89984)>}</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)>OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Option</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Item</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> get_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Path</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>get</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#427b58,#8ec07c)>&</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>map</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)>v</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)> v</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>delete</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/</span><span style=color:light-dark(#7c6f64,#a89984)>{</span><span style=color:light-dark(#79740e,#b8bb26)>id</span><span style=color:light-dark(#7c6f64,#a89984)>}</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)>OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Option</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Item</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> delete_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Path</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>remove</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#427b58,#8ec07c)>&</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>map</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>_</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> v</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)> v</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>tokio</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>main</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> main</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> app_state</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>new</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>default</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#7c6f64,#a89984)> (</span><span style=color:light-dark(#076678,#83a598)>app</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> api</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> OpenApiRouter</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>new</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>routes</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>routes!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>create_item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>routes</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>routes!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>get_item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>routes</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>routes!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>delete_item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>layer</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#427b58,#8ec07c)>        .</span><span style=color:light-dark(#b57614,#fabd2f)>split_for_parts</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> open_api_builder</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> OpenApiBuilder</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>new</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>build</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>nest</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/items</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> api</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> url</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#7c6f64,#a89984)> "</span><span style=color:light-dark(#79740e,#b8bb26)>localhost:3000</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> listener</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> tokio</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>net</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>TcpListener</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>bind</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#427b58,#8ec07c)>&</span><span style=color:light-dark(#076678,#83a598)>url</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#9d0006,#fb4934)>await</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>unwrap</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> swagger_docs</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> SwaggerUi</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>new</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/docs</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>url</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/api-docs/openapi.json</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> open_api_builder</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> app</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> Router</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>new</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>nest</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/items</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> app</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>merge</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>swagger_docs</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    axum</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>serve</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>listener</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> app</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#9d0006,#fb4934)>await</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>unwrap</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span></code></pre></details><p>Run the following command at the root of the project<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=shellscript><span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>cargo</span><span style=color:light-dark(#79740e,#b8bb26)> run</span></span></code></pre><p>And open the webpage at <code>localhost:3000/docs</code> to see your API docs<p><img alt=image src=https://uncomfyhalomacro.pl/blog/202601195548/./1.png><p>You can start creating new items by interacting the <code>POST /items/create</code> section.<p><img alt=image src=https://uncomfyhalomacro.pl/blog/202601195548/./2.png><h2 id=but-there-is-a-problem>But there is a problem<a aria-label="Anchor link for: but-there-is-a-problem" class=zola-anchor href=#but-there-is-a-problem>§</a></h2><p>You'll notice by now that interacting with the <code>GET /items/{id}</code> with the ID presented by the response you got from <code>POST /items/create</code> gives you a similar response like below<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=json><span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>[</span></span>
<span class=giallo-l><span style=color:light-dark(#8f3f71,#d3869b)>  2852292982480790000</span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#8f3f71,#d3869b)>  null</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>]</span></span></code></pre><p>You can test this by checking that the IDs do not really match by modifying the <code>create_item</code> method into<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=rust><span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>post</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span>path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)> "</span><span style=color:light-dark(#79740e,#b8bb26)>/create</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status </span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)> OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body </span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)> (</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> create_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> id</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> u64</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> random</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    println!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>Creating item with ID: </span><span style=color:light-dark(#7c6f64,#a89984)>{</span><span style=color:light-dark(#7c6f64,#a89984)>}</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> generate_random_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#8f3f71,#d3869b)>10</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> size</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>capacity</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)> {</span><span style=color:light-dark(#076678,#83a598)> size</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#7c6f64,#a89984)> }</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#076678,#83a598)>    app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>insert</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span></code></pre><p>so you can get output like this<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=plain><span class=giallo-l><span>    Finished `dev` profile [unoptimized + debuginfo] target(s) in 1.48s</span></span>
<span class=giallo-l><span>     Running `target/debug/axum-api`</span></span>
<span class=giallo-l><span>Creating item with ID: 4874131135699964599</span></span></code></pre><p>The cause of this problem? Javascript.<h4 id=how-to-handle-large-numbers>How to handle large numbers<a aria-label="Anchor link for: how-to-handle-large-numbers" class=zola-anchor href=#how-to-handle-large-numbers>§</a></h4><p>Javascript cannot handle numbers that are larger than <code>9,007,199,254,740,991</code>. To put that into perspective, let's say we set our path parameter as type <code>Path&lt;u64></code>. Surely enough, Rust can handle that large number but our Swagger UI cannot since it runs on Javascript via web browser.<blockquote><p>You can test with the <code>curl</code> command and it should work just fine though on <code>curl</code>.</blockquote><p>To fix this issue, you either change the integer type that can fit the integer limit of <code>9,007,199,254,740,991</code> from Javascript e.g. <code>u8</code> or <code>u32</code>. Another nicer approach is to pass a custom JSON with the <code>id</code> as a string as part of our <strong>response</strong> which is the most common solution to this problem. Hence, each of our API endpoints should return numbers as a string if we want to preserve its size and length for conversion later in the Rust backend.<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=rust><span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>post</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span>path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)> "</span><span style=color:light-dark(#79740e,#b8bb26)>/create</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status </span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)> OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body </span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)> (</span><span style=color:light-dark(#b57614,#fabd2f)>String</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> create_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> id</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> u64</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> random</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    println!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>Creating item with ID: </span><span style=color:light-dark(#7c6f64,#a89984)>{</span><span style=color:light-dark(#7c6f64,#a89984)>}</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> generate_random_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#8f3f71,#d3869b)>10</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> size</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>capacity</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)> {</span><span style=color:light-dark(#076678,#83a598)> size</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#7c6f64,#a89984)> }</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#076678,#83a598)>    app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>insert</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>to_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>get</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/</span><span style=color:light-dark(#7c6f64,#a89984)>{</span><span style=color:light-dark(#79740e,#b8bb26)>id</span><span style=color:light-dark(#7c6f64,#a89984)>}</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)>OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>String</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Option</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Item</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> get_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Path</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>get</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#427b58,#8ec07c)>&</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>map</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)>v</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)> v</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>to_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>delete</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/</span><span style=color:light-dark(#7c6f64,#a89984)>{</span><span style=color:light-dark(#79740e,#b8bb26)>id</span><span style=color:light-dark(#7c6f64,#a89984)>}</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)>OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>String</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Option</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Item</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> delete_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Path</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>remove</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#427b58,#8ec07c)>&</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>map</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>_</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> v</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)> v</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>to_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)>item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span></code></pre><p>You can see here that we have adjusted by calling the <code>.to_string</code> method. You might want to add a method for <code>Item</code> to convert large numbers to strings e.g.<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=rust><span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>impl</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>    fn</span><span style=color:light-dark(#b57614,#fabd2f)> to_javascript_compatible_values</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#427b58,#8ec07c)>&</span><span style=color:light-dark(#076678,#83a598)>self</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#b57614,#fabd2f)> serde_json</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Value</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>        let</span><span style=color:light-dark(#076678,#83a598)> size_str</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> self</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>size</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>to_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>        let</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> self</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>name</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>to_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>        serde_json</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>json!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>            {</span><span style=color:light-dark(#7c6f64,#a89984)> "</span><span style=color:light-dark(#79740e,#b8bb26)>size</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#076678,#83a598)> size_str</span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>               "</span><span style=color:light-dark(#79740e,#b8bb26)>name</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#076678,#83a598)> name</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>            }</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>        )</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>    }</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span></code></pre><p>of which we can now use to further update the API endpoint functions<pre style="color-scheme:light dark;color:light-dark(#3c3836,#ebdbb2);background-color:light-dark(#f9f5d7,#1d2021)" class=giallo><code data-lang=rust><span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>post</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span>path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)> "</span><span style=color:light-dark(#79740e,#b8bb26)>/create</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status </span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)> OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body </span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)> (</span><span style=color:light-dark(#b57614,#fabd2f)>String</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> serde_json</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Value</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> create_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> id</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> u64</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> random</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    println!</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>Creating item with ID: </span><span style=color:light-dark(#7c6f64,#a89984)>{</span><span style=color:light-dark(#7c6f64,#a89984)>}</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> generate_random_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#8f3f71,#d3869b)>10</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> size</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>capacity</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#b57614,#fabd2f)> Item</span><span style=color:light-dark(#7c6f64,#a89984)> {</span><span style=color:light-dark(#076678,#83a598)> size</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> name</span><span style=color:light-dark(#7c6f64,#a89984)> }</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#076678,#83a598)>    app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>insert</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>clone</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>to_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>to_javascript_compatible_values</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>get</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/</span><span style=color:light-dark(#7c6f64,#a89984)>{</span><span style=color:light-dark(#79740e,#b8bb26)>id</span><span style=color:light-dark(#7c6f64,#a89984)>}</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)>OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>String</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Option</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#076678,#83a598)>serde_json</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Value</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> get_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Path</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>get</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#427b58,#8ec07c)>&</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>map</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)>v</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)> v</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>to_javascript_compatible_values</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>to_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>#</span><span style=color:light-dark(#7c6f64,#a89984)>[</span><span>utoipa</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span>path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>delete</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> path</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#79740e,#b8bb26)>/</span><span style=color:light-dark(#7c6f64,#a89984)>{</span><span style=color:light-dark(#79740e,#b8bb26)>id</span><span style=color:light-dark(#7c6f64,#a89984)>}</span><span style=color:light-dark(#7c6f64,#a89984)>"</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> responses</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span>status</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#b57614,#fabd2f)>OK</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span> body</span><span style=color:light-dark(#427b58,#8ec07c)>=</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#b57614,#fabd2f)>String</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#b57614,#fabd2f)> Option</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#076678,#83a598)>serde_json</span><span style=color:light-dark(#427b58,#8ec07c)>::</span><span style=color:light-dark(#b57614,#fabd2f)>Value</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>]</span></span>
<span class=giallo-l><span style=color:light-dark(#9d0006,#fb4934)>async</span><span style=color:light-dark(#9d0006,#fb4934)> fn</span><span style=color:light-dark(#b57614,#fabd2f)> delete_item</span><span style=color:light-dark(#7c6f64,#a89984)>(</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Path</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Path</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>u64</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Extension</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>app_state</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)>:</span><span style=color:light-dark(#b57614,#fabd2f)> Extension</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>Arc</span><span style=color:light-dark(#7c6f64,#a89984)>&lt;</span><span style=color:light-dark(#b57614,#fabd2f)>AppState</span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>></span><span style=color:light-dark(#7c6f64,#a89984)>,</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#427b58,#8ec07c)> -></span><span style=color:light-dark(#9d0006,#fb4934)> impl</span><span style=color:light-dark(#b57614,#fabd2f)> IntoResponse</span><span style=color:light-dark(#7c6f64,#a89984)> {</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> app_state</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span>bucket</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>remove</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#427b58,#8ec07c)>&</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#af3a03,#fe8019)>    let</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#427b58,#8ec07c)> =</span><span style=color:light-dark(#076678,#83a598)> maybe_item</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>map</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>_</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> v</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#9d0006,#fb4934)>|</span><span style=color:light-dark(#076678,#83a598)> v</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>to_javascript_compatible_values</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>;</span></span>
<span class=giallo-l><span style=color:light-dark(#b57614,#fabd2f)>    Json</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#076678,#83a598)>id</span><span style=color:light-dark(#427b58,#8ec07c)>.</span><span style=color:light-dark(#b57614,#fabd2f)>to_string</span><span style=color:light-dark(#7c6f64,#a89984)>(</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>,</span><span style=color:light-dark(#076678,#83a598)> item</span><span style=color:light-dark(#7c6f64,#a89984)>)</span><span style=color:light-dark(#7c6f64,#a89984)>)</span></span>
<span class=giallo-l><span style=color:light-dark(#7c6f64,#a89984)>}</span></span></code></pre><h1 id=conclusion>Conclusion<a aria-label="Anchor link for: conclusion" class=zola-anchor href=#conclusion>§</a></h1><p>You can see the full result in the following video below</p><video controls width=720><source src=./1.mp4 type=video/mp4></video><p>The full repository can be found <a href=https://codeberg.org/uncomfyhalomacro/axum-utoipa-example rel=external>here</a>.</section></article></div><section class=webring><h3>Articles from blogs I follow around the net</h3><section class=articles><div class=article><h4 class=title dir=auto><a href=https://ryanaque.com/wfd/should-date-created rel=noopener target=_blank>[WFD 33] this blog site needs a date created</a></h4><p class=summary dir=auto>only last updated matters according to WFD 16. but mass-updating timestamps when i change a shared admonition makes every WFD look freshly written.</p><small class=source> via <a href=https://ryanaque.com/>Ryana May Que — Writings for Discussion</a></small><small class=date>February 28, 2026</small></div><div class=article><h4 class=title dir=auto><a href=https://soatok.blog/2026/02/25/cryptography-engineering-has-an-intrinsic-duty-of-care/ rel=noopener target=_blank>Cryptography Engineering Has An Intrinsic Duty of Care</a></h4><p class=summary dir=auto>To understand my point, I need to first explain three different cryptography attack papers / blog posts. I promise this won’t be boring. Three Little Disclosures Misuse-Prone Ciphers For All In a blog post titled Carelessness versus craftsmanship in crypto…</p><small class=source> via <a href=https://soatok.blog/>Dhole Moments</a></small><small class=date>February 25, 2026</small></div><div class=article><h4 class=title dir=auto><a href=https://macwright.com/2026/02/25/new-tote.html rel=noopener target=_blank>New tote bag</a></h4><p class=summary dir=auto>I recently took an hour or two to stitch together a new tote bag. I have a stash of materials for this because a sewing company in Brooklyn's 'Industry City' (an isolated business park) was going out of business. I regret not buying out much more of the in…</p><small class=source> via <a href=https://macwright.com/>macwright.com</a></small><small class=date>February 25, 2026</small></div><div class=article><h4 class=title dir=auto><a href=https://www.labs.greynoise.io/grimoire/2026-02-24-whats-that-string/ rel=noopener target=_blank>What’s That String? That Time a Weird String Revealed a Whole Operation</a></h4><p class=summary dir=auto>How it felt to work on this post. Shikanoko Nokonoko Koshitantan is written by Takashi Aoshima and published by Wit Studio. It all started with a slack message from boB Rudis: “Hey, I keep seeing this string. Any ideas?” d2=%3D%3DQXisTKpcCd4RnLsF3ckN3LlR…</p><small class=source> via <a href=https://www.labs.greynoise.io/grimoire/>GreyNoise Labs</a></small><small class=date>February 24, 2026</small></div><div class=article><h4 class=title dir=auto><a href=https://www.gingerbill.org/article/2026/02/23/designing-odins-casting-syntax/ rel=noopener target=_blank>Designing Odin's Casting Syntax</a></h4><p class=summary dir=auto>Odin;s declaration syntax becomes second nature to everyone who uses the language but I do sometimes get asked ;Why are there two ways to do type conversions?; Enough that I had to make an FAQ entry..The reason that there are two ways to do type conversio…</p><small class=source> via <a href=https://www.gingerbill.org/article/>gingerBill - Articles</a></small><small class=date>February 23, 2026</small></div><div class=article><h4 class=title dir=auto><a href=https://emersion.fr/blog/2026/status-update-84/ rel=noopener target=_blank>Status update, February 2026</a></h4><p class=summary dir=auto>Hi all! Lars has contributed an implementation independent test suite for the scfg configuration file format. This is quite nice for implementors, they get a base test suite for free. I’ve added support for it for libscfg, the C implementation. I’ve spent …</p><small class=source> via <a href=https://emersion.fr/blog/>emersion</a></small><small class=date>February 21, 2026</small></div><div class=article><h4 class=title dir=auto><a href=https://walnut356.github.io/posts/inspecting-the-supernote-note-format/ rel=noopener target=_blank>Investigating the SuperNote Notebook Format</a></h4><p class=summary dir=auto>I'm a big fan of eink tablets. I read a lot, I write a lot, I prefer handwritten notes, it's a match made in heaven. I've been using a Kindle Scribe for the past several years - I probably used it as much or more than my phone. Recently, I upgraded to a Su…</p><small class=source> via <a href=https://walnut356.github.io/>Cracking the Shell</a></small><small class=date>February 20, 2026</small></div><div class=article><h4 class=title dir=auto><a href=http://blog.clement.delafargue.name/posts/2026-02-16-luxe-ocaml-et-volupte.html rel=noopener target=_blank>Luxe, ocaml et volupté</a></h4><p class=summary dir=auto>Luxe, ocaml et volupté by Clément Delafargue on February 16, 2026 Tagged as: ocaml. After a couple years using rust as my primary language, I’ve got a new job where I’m using a variety of languages (including rust and typescript), but mostly go 1. So…</p><small class=source> via <a href=http://blog.clement.delafargue.name/>Clément Delafargue - RSS feed</a></small><small class=date>February 16, 2026</small></div><div class=article><h4 class=title dir=auto><a href=https://maia.crimew.gay/posts/kinemaster-drm/ rel=noopener target=_blank>How To Add DRM To Your Backend (easy) [2026 WORKING]</a></h4><p class=summary dir=auto>How KineMaster stopped some modded clients from accessing their asset market</p><small class=source> via <a href=https://maia.crimew.gay/>maia blog</a></small><small class=date>February 14, 2026</small></div><div class=article><h4 class=title dir=auto><a href=https://www.noobscience.in/blog/push-comes-to-shove/ rel=noopener target=_blank>Push comes to shove tools</a></h4><p class=summary dir=auto>Your tools are extensions of your skills</p><small class=source> via <a href=https://www.noobscience.in/>Ishan Writes</a></small><small class=date>February 09, 2026</small></div><div class=article><h4 class=title dir=auto><a href=https://drewdevault.com/2026/01/29/2026-01-29-Cult-of-TDD-and-LLMs.html rel=noopener target=_blank>The cults of TDD and GenAI</a></h4><p class=summary dir=auto>I’ve gotten a lot of flack throughout my career over my disdain towards test-driven development (TDD). I have met a lot of people who swear by it! And, I have also met a lot of people who insisted that I adopt it, too, often with the implied threat of appe…</p><small class=source> via <a href=https://drewdevault.com/>Drew DeVault's blog</a></small><small class=date>January 29, 2026</small></div><div class=article><h4 class=title dir=auto><a href=https://seanmonstar.com/blog/2025-in-review/ rel=noopener target=_blank>2025 in review</a></h4><p class=summary dir=auto>Come along with me as I review the past year. Heh, I often start these kinds of posts right at the start of the year, but it takes a few weeks longer than I ever expect to think them through.1 Two years of being independent After a second year of operati…</p><small class=source> via <a href=https://seanmonstar.com/>seanmonstar</a></small><small class=date>January 27, 2026</small></div><div class=article><h4 class=title dir=auto><a href=https://pcloadletter.dev/blog/birthday-paradox/ rel=noopener target=_blank>The Birthday Paradox, simulated</a></h4><p class=summary dir=auto>I'm a fan of simulating counterintuitive statistics. I recently did this with the Monty Hall problem and I really enjoyed how it turned out. A similarly interesting statistical puzzle is the birthday paradox: you only need to get 23 people in a room a room…</p><small class=source> via <a href=https://pcloadletter.dev/>pcloadletter</a></small><small class=date>January 23, 2026</small></div><div class=article><h4 class=title dir=auto><a href=https://ludic.mataroa.blog/blog/merry-christmas-ya-filthy-animals-2025/ rel=noopener target=_blank>Merry Christmas, Ya Filthy Animals (2025)</a></h4><p class=summary dir=auto>It’s my last day of writing for the year, so I’m going to try keep this one quick – it was knocked out over three hours, so I hope you can forgive me if it’s a bit clumsier than my usual writing. For some strange reason, one of the few clear memories I hav…</p><small class=source> via <a href=https://ludic.mataroa.blog/>Ludicity</a></small><small class=date>December 27, 2025</small></div><div class=article><h4 class=title dir=auto><a href=https://www.roboleary.net/blog/github-migration/ rel=noopener target=_blank>Why are people migrating away from GitHub?</a></h4><p class=summary dir=auto>I noticed some people migrating away from GitHub recently. I was curious to understand the rationale. Is it a blip or is it a sign of prolonged exodus?</p><small class=source> via <a href=https://www.roboleary.net/>Rob O'Leary | Blog</a></small><small class=date>December 22, 2025</small></div><div class=article><h4 class=title dir=auto><a href=https://fy.blackhats.net.au/blog/2025-12-17-yep-passkeys-still-have-problems/ rel=noopener target=_blank>Yep, Passkeys Still Have Problems</a></h4><p class=summary dir=auto>It's now late into 2025, and just over a year since I wrote my last post on Passkeys. The prevailing dialogue that I see from thought leaders is "addressing common misconceptions" around Passkeys, the implication being that "you just don't understand it co…</p><small class=source> via <a href=https://fy.blackhats.net.au/>Firstyear's blog-a-log</a></small><small class=date>December 17, 2025</small></div><div class=article><h4 class=title dir=auto><a href=https://samcurry.net/hacking-clubwpt-gold rel=noopener target=_blank>Hacking the World Poker Tour: Inside ClubWPT Gold’s Back Office</a></h4><p class=summary dir=auto>In June, 2025, Shubs Shah and I discovered a vulnerability in the online poker website ClubWPT Gold which would have allowed an attacker to fully access the core back office application that is used for all administrative site functionality.</p><small class=source> via <a href=https://samcurry.net/>Blog | Sam Curry</a></small><small class=date>October 12, 2025</small></div><div class=article><h4 class=title dir=auto><a href=https://sebastian.lauwe.rs/blog/parallelising-makefile-uv/ rel=noopener target=_blank>Testing multiple versions of Python in parallel</a></h4><p class=summary dir=auto>Daniel Roy Greenfeld wrote about how to test your code for multiple versions of Python using `uv`. I follow up with a small improvement to the Makefile.</p><small class=source> via <a href=https://sebastian.lauwe.rs/>Technically Personal</a></small><small class=date>July 21, 2025</small></div></section><p class=attribution>Generated by <a href=https://github.com/lukehsiao/openring-rs>openring-rs</a></section><footer>follow <a href=https://fosstodon.org/@uncomfyhalomacro rel=me target=_blank>uncomfyhalomacro@fosstodon.org</a> ⋅ © 2024 <a href=https://codeberg.org/uncomfyhalomacro/gruvbox-v target=_blank>gruvbox-v</a> ⋅ powered by <a href=https://getzola.org target=_blank>zola</a> ⋅ theme by <a href=https://codeberg.org/uncomfyhalomacro target=_blank>uncomfyhalomacro</a> ⋅ Content <a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank>CC-BY-4.0</a></footer></div><div class=right-grid><div class=toc><h1>Contents</h1><div class=toc-container><ul><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#preparing-your-project>Preparing your project</a><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#what-this-project-does>What this project does</a> <ul><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#creating-our-types>Creating our types</a><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#building-our-api-endpoints>Building our API endpoints</a></ul><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#testing-our-api>Testing our API</a><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#but-there-is-a-problem>But there is a problem</a> <ul><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#how-to-handle-large-numbers>How to handle large numbers</a></ul><li><a href=https://uncomfyhalomacro.pl/blog/202601195548/#conclusion>Conclusion</a></ul></div></div></div></div><div class=topnav><a class=icon href=javascript:void(0); onclick=resize()> <img alt="favicon here" class=icon_img src=/favicon.png> </a><a class=active href=https://uncomfyhalomacro.pl/>home</a><a href=https://uncomfyhalomacro.pl/tags>tags</a><a href=https://uncomfyhalomacro.pl/blog/>blog</a><a href=/microbio-cv.pdf>microbio cv</a><a href=/tech-cv.pdf>tech cv</a><a href=/public.txt>gpg keys</a><div id=myLinks><a href=https://uncomfyhalomacro.pl/lecture/>lecture</a><a href=https://uncomfyhalomacro.pl/poetry/>poetry</a><a href=https://uncomfyhalomacro.pl/scripts/>scripts</a></div></div></div>